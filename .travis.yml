language: php

php:
  - 7.0

sudo: true

before_install:
  - sudo apt-get update  -yqq
  - sudo apt-get install -yqq libssh2-1-dev libssh2-php openssh-client openssh-server proftpd
  # ls -l $HOME/.phpenv/versions/$(phpenv version-name)/lib/php/extensions/
  # extensionspath=`ls -l $HOME/.phpenv/versions/$(phpenv version-name)/lib/php/extensions/|grep no-debug-zts|awk '{print $9}'|tr -d '\n'`
  # echo $extensionspath
  # cp tests/bin/ssh2.so $HOME/.phpenv/versions/$(phpenv version-name)/lib/php/extensions/$extensionspath/
  # echo "extension=ssh2.so" >> $HOME/.phpenv/versions/$(phpenv version-name)/etc/php.ini

before_script:
  - mkdir -p build/logs
  - sh tests/before_script.sh
  - composer install --no-progress --no-ansi --no-interaction --profile

script:
  # php -r "phpinfo();"
  # cat $HOME/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - composer test

after_success:
  - php tests/bin/ocular.phar code-coverage:upload --format=php-clover build/logs/clover.xml --verbose
  - php tests/bin/coveralls.phar --config=.coveralls.yml --coverage_clover=build/logs/clover.xml --verbose

notifications:
  email: false

# vim:fdl=0:sts=2:sw=2:ts=2
